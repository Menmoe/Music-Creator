<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sefira Music Creator</title>
    <style>
        html{
            background-color: rgb(30,30,30);
            color: #ccc;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #piano{
            
        }
        .keys{
            position: relative;
            cursor: pointer;
            display: inline-block;
            transition: all 0.1s;
        }
        .keys:hover{
            /*transform: translateY(5px);*/
            opacity: 0.8;
        }
        .whitekeys{
            background-color: white;
            height: 180px;
            width: 40px;
            margin: 1px;
        }
        .blackkeys{
            background-color: black;
            height: 100px;
            width: 20px;
            position: absolute;
            right: -12px;
            z-index: 2;
        }
        #notes{
            width: 494px;
            height: 100px;
            position: relative;
            left: 2em;
        }

        #delete-button {
            margin-left: 10px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            border: 3px solid rgb(207, 7, 7);
            background-color:rgb(27, 27, 27);
            color:rgb(207, 7, 7);
            height: 40px;
            width: 40px;
            font-size: 30px;
            position: relative;
            left: 1em;
            top: -1em;
            cursor: pointer;
            transition: all 0.1s;
        }

        #delete-button:hover {
            transform: translateY(-3px);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <h1>Sefira Music Creator</h1>
    <div id="piano">
        <div class="keys whitekeys" oncontextmenu="addKey('c1')" onclick="addKey('c1,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('d1')" onclick="addKey('d1,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('e1')" onclick="addKey('e1,')"></div>
        <div class="keys whitekeys" oncontextmenu="addKey('f1')" onclick="addKey('f1,')">
           <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('g1')" onclick="addKey('g1,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('a2')" onclick="addKey('a2,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('b2')" onclick="addKey('b2,')"></div>
        <div class="keys whitekeys" oncontextmenu="addKey('c2')" onclick="addKey('c2,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('d2')" onclick="addKey('d2,')">
            <div class="keys blackkeys"></div>
        </div>
        <div class="keys whitekeys" oncontextmenu="addKey('e2')" onclick="addKey('e2,')"></div>
        <div class="keys whitekeys" onclick="addKey(',')" style="background-color: gray;"></div>
    </div>
    <textarea id="notes" placeholder="Click on keyboard to input notes"></textarea>
    <button id="delete-button" onclick="undo()">&times;</button>
<br>
<button onclick="play()">Play!</button>
<script>
    document.addEventListener('keydown', e => {
        if(e.keyCode == 32) play();
        if(e.key.toLocaleLowerCase() == 'z' && e.ctrlKey) undo();
    })

    let speed = 300;

    function undo() {
        document.getElementById('notes').value = document.getElementById('notes').value.replace(/[a-g]\d,? $/,'');
    }

    function addKey(key, e=event){
        e.preventDefault();
        document.getElementById('notes').value += key + " ";
    }
    async function play(){
        allNotes = document.getElementById('notes').value.split(', ');
        for(i=0;i<allNotes.length;i++){
            allNotes[i].split(' ').forEach(note => {
            if(note.length>1) {
                let sound = new Audio();
                sound.src = 'voices/'+note+'.wav';
                sound.play();
            }
            });
            await sleep(speed);
        }
        /*allNotes.forEach(async (note) => {
            if(note.length<2) {return;}
           // voices[note].play();\
            await sleep(1000);
            //voices[note].pause();
            });*/
    }
    async function delay(ms){
        return new Promise(resolve=>{
            setTimeout(()=>{resolve('')},ms);
            });
    }

    //const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay));

    function sleep(ms){
        return new Promise(r=>setTimeout(r,ms));
    }

</script>
</body>
</html>
